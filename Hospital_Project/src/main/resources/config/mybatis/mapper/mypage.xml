<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">

<!-- 기본정보변경 -->	
<update id="update_patient_info" parameterType="vo.PatientVO">
	update patient set
		pat_email = #{ pat_email },
		pat_address_post = #{ pat_address_post },
		pat_address_road = #{ pat_address_road },
		pat_address_detail = #{ pat_address_detail },
		pat_phone = #{ pat_phone },
		pat_phone2 = #{ pat_phone2 },
		pat_birthday = #{ pat_birthday },
		pat_gender = #{ pat_gender }
	where pat_idx=#{pat_idx}
</update>

<!-- 비밀번호변경 -->
<update id="update_patient_pwd" parameterType="java.util.Map">
	update patient set pat_pwd = #{ pwd_new } where pat_idx = #{ pat_idx }
</update>

<!-- 예약내역조회 -->
<select id="select_reservation_list" parameterType="int" resultType="vo.MypageResListVO">
	SELECT 
	    dept.dept_name AS dept_name,
	    pro.pro_name AS pro_name,
	    pro.pro_file AS pro_file,
	    TO_CHAR(res.res_time, 'YYYY-MM-DD HH24:MI') AS res_time,
	    dept.dept_loc AS dept_loc
	FROM 
	    reservation res
	JOIN 
	    professor pro ON res.pro_idx = pro.pro_idx
	JOIN 
	    department dept ON pro.dept_idx = dept.dept_idx
	JOIN 
	    patient pat ON res.pat_idx = pat.pat_idx
	WHERE 
	    pat.pat_idx = #{pat_idx}
</select>

</mapper>